# 西安石油大学校园二手商品交易网接口文档

## 1. 认证接口

### 1.1 用户注册
- **URL**：`/api/user/register`
- **方法**：`POST`
- **请求参数**：
  ```json
  {
    "username": "string", // 用户名
    "password": "string", // 密码
    "realName": "string", // 真实姓名
    "email": "string", // 邮箱
    "phone": "string", // 电话
    "studentId": "string", // 学号
    "department": "string" // 学院
  }
  ```
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 1.2 用户登录
- **URL**：`/api/user/login`
- **方法**：`POST`
- **请求参数**：
  ```json
  {
    "account": "string", // 用户名或邮箱或电话
    "password": "string" // 密码
  }
  ```
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "token": "string", // JWT token
      "userInfo": {
        "id": 1,
        "username": "string",
        "role": "user", // 角色：user或admin
        "realName": "string",
        "email": "string",
        "phone": "string",
        "department": "string",
        "avatar": "string"
      }
    }
  }
  ```

### 1.3 获取用户信息
- **URL**：`/api/user/info`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "username": "string",
      "role": "user",
      "realName": "string",
      "email": "string",
      "phone": "string",
      "department": "string",
      "avatar": "string"
    }
  }
  ```

## 2. 商品接口

### 2.1 获取商品分类列表
- **URL**：`/api/category/list`
- **方法**：`GET`
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {
        "id": 1,
        "name": "电子产品",
        "parentId": 0,
        "status": 1
      },
      {
        "id": 2,
        "name": "手机",
        "parentId": 1,
        "status": 1
      }
    ]
  }
  ```

### 2.2 获取商品列表
- **URL**：`/api/product/list`
- **方法**：`GET`
- **请求参数**：
  - `keyword`: 搜索关键词
  - `categoryId`: 分类ID
  - `minPrice`: 最低价格
  - `maxPrice`: 最高价格
  - `status`: 商品状态
  - `sort`: 排序方式 (latest, priceAsc, priceDesc, hot)
  - `pageNum`: 页码，默认1
  - `pageSize`: 每页数量，默认10
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "id": 1,
          "title": "iPhone 13",
          "description": "9成新，无磕碰",
          "price": 4500,
          "originalPrice": 6999,
          "images": ["url1", "url2"],
          "status": 1,
          "condition": "9成新",
          "transactionType": 2,
          "viewCount": 100,
          "favoriteCount": 10,
          "categoryId": 2,
          "categoryName": "手机",
          "sellerName": "张三",
          "sellerDepartment": "计算机学院",
          "sellerAvatar": "url",
          "createdAt": "2023-01-01 10:00:00",
          "isFavorite": false
        }
      ],
      "total": 1,
      "pageNum": 1,
      "pageSize": 10
    }
  }
  ```

### 2.3 获取商品详情
- **URL**：`/api/product/{id}`
- **方法**：`GET`
- **路径参数**：`id`: 商品ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "title": "iPhone 13",
      "description": "9成新，无磕碰",
      "price": 4500,
      "originalPrice": 6999,
      "images": ["url1", "url2"],
      "status": 1,
      "condition": "9成新",
      "transactionType": 2,
      "viewCount": 100,
      "favoriteCount": 10,
      "categoryId": 2,
      "categoryName": "手机",
      "sellerId": 1,
      "sellerName": "张三",
      "sellerDepartment": "计算机学院",
      "sellerAvatar": "url",
      "createdAt": "2023-01-01 10:00:00",
      "isFavorite": false
    }
  }
  ```

### 2.4 发布商品
- **URL**：`/api/product`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "title": "string",
    "description": "string",
    "price": 0,
    "originalPrice": 0,
    "images": ["string"],
    "categoryId": 0,
    "condition": "string",
    "transactionType": 0
  }
  ```
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": 1 // 商品ID
  }
  ```

### 2.5 编辑商品
- **URL**：`/api/product/{id}`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 商品ID
- **请求参数**：同发布商品
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 2.6 删除商品
- **URL**：`/api/product/{id}`
- **方法**：`DELETE`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 商品ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 2.7 获取我的商品
- **URL**：`/api/product/my`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `status`: 商品状态
  - `pageNum`: 页码，默认1
  - `pageSize`: 每页数量，默认10
- **返回结果**：同获取商品列表

### 2.8 更新商品状态
- **URL**：`/api/product/{id}/status`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 商品ID
- **请求参数**：
  - `status`: 商品状态 (0-待审核，1-在售，2-已下架，3-已售出，4-审核拒绝)
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 2.9 收藏商品
- **URL**：`/api/product/{id}/favorite`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 商品ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 2.10 取消收藏
- **URL**：`/api/product/{id}/favorite`
- **方法**：`DELETE`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 商品ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 2.11 获取收藏列表
- **URL**：`/api/product/favorite`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `pageNum`: 页码，默认1
  - `pageSize`: 每页数量，默认10
- **返回结果**：同获取商品列表

## 3. 订单接口

### 3.1 创建订单
- **URL**：`/api/order`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "productId": 0,
    "quantity": 1,
    "transactionType": 0,
    "receiverName": "string",
    "receiverPhone": "string",
    "receiverAddress": "string",
    "remark": "string"
  }
  ```
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "orderNo": "string",
      "productId": 1,
      "productTitle": "string",
      "productImage": "string",
      "quantity": 1,
      "totalAmount": 4500,
      "transactionType": 2,
      "status": 0,
      "createdAt": "string"
    }
  }
  ```

### 3.2 获取订单列表
- **URL**：`/api/order/list`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `viewType`: 视图类型 (buyer-买家视角, seller-卖家视角)
  - `status`: 订单状态
  - `orderNo`: 订单号
  - `startDate`: 开始日期
  - `endDate`: 结束日期
  - `pageNum`: 页码，默认1
  - `pageSize`: 每页数量，默认10
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "id": 1,
          "orderNo": "string",
          "productId": 1,
          "productTitle": "string",
          "productImage": "string",
          "quantity": 1,
          "totalAmount": 4500,
          "transactionType": 2,
          "status": 0,
          "buyerId": 2,
          "buyerName": "string",
          "sellerId": 1,
          "sellerName": "string",
          "createdAt": "string"
        }
      ],
      "total": 1,
      "pageNum": 1,
      "pageSize": 10
    }
  }
  ```

### 3.3 获取订单详情
- **URL**：`/api/order/{id}`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 订单ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "orderNo": "string",
      "productId": 1,
      "productTitle": "string",
      "productImage": "string",
      "quantity": 1,
      "totalAmount": 4500,
      "transactionType": 2,
      "status": 0,
      "buyerId": 2,
      "buyerName": "string",
      "sellerId": 1,
      "sellerName": "string",
      "address": {
        "receiverName": "string",
        "receiverPhone": "string",
        "receiverAddress": "string"
      },
      "remark": "string",
      "createdAt": "string",
      "timeline": [
        {
          "time": "string",
          "content": "string"
        }
      ]
    }
  }
  ```

### 3.4 取消订单
- **URL**：`/api/order/{id}`
- **方法**：`DELETE`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 订单ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 3.5 确认收货
- **URL**：`/api/order/{id}/confirm`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 订单ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 3.6 发货/确认面交
- **URL**：`/api/order/{id}/deliver`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 订单ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

## 4. 评价接口

### 4.1 创建评价
- **URL**：`/api/review`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "orderId": 0,
    "rating": 5,
    "comment": "string"
  }
  ```
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

## 5. 文件上传接口

### 5.1 上传文件
- **URL**：`/api/file/upload`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `file`: 要上传的文件（multipart/form-data）
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "url": "string" // 上传后的文件URL
    }
  }
  ```

## 6. 管理员接口

### 6.1 商品审核
- **URL**：`/api/admin/product/review`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "id": 0,
    "status": 1,
    "remark": "string"
  }
  ```
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 6.2 获取待审核商品
- **URL**：`/api/admin/product/pending`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `pageNum`: 页码，默认1
  - `pageSize`: 每页数量，默认10
- **返回结果**：同获取商品列表

### 6.3 分类管理

#### 6.3.1 添加分类
- **URL**：`/api/category`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  ```json
  {
    "name": "string",
    "parentId": 0,
    "sortOrder": 0
  }
  ```
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": 1
  }
  ```

#### 6.3.2 编辑分类
- **URL**：`/api/category/{id}`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 分类ID
- **请求参数**：同添加分类
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

#### 6.3.3 删除分类
- **URL**：`/api/category/{id}`
- **方法**：`DELETE`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 分类ID
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 6.4 用户管理

#### 6.4.1 获取用户列表
- **URL**：`/api/admin/user/list`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `username`: 用户名
  - `realName`: 真实姓名
  - `status`: 用户状态
  - `pageNum`: 页码，默认1
  - `pageSize`: 每页数量，默认10
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "id": 1,
          "username": "string",
          "realName": "string",
          "email": "string",
          "phone": "string",
          "studentId": "string",
          "department": "string",
          "status": 1,
          "role": "user",
          "createTime": "string"
        }
      ],
      "total": 1,
      "pageNum": 1,
      "pageSize": 10
    }
  }
  ```

#### 6.4.2 更新用户状态
- **URL**：`/api/admin/user/{id}/status`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer {token}`
- **路径参数**：`id`: 用户ID
- **请求参数**：
  - `status`: 用户状态 (0-禁用，1-启用)
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

### 6.5 统计分析

#### 6.5.1 获取统计数据
- **URL**：`/api/admin/statistics`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer {token}`
- **返回结果**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "totalUsers": 0,
      "totalProducts": 0,
      "totalOrders": 0,
      "totalSales": 0,
      "userGrowth": [],
      "salesTrend": []
    }
  }
  ```

## 7. 响应格式

### 7.1 成功响应
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 7.2 失败响应
```json
{
  "code": 500,
  "message": "错误信息",
  "data": null
}
```

## 8. 状态码说明

| 状态码 | 说明 |
| --- | --- |
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权，token过期或无效 |
| 403 | 禁止访问，权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 9. 公共参数

### 9.1 分页参数
- `pageNum`: 页码，默认1
- `pageSize`: 每页数量，默认10

### 9.2 排序参数
- `sort`: 排序字段
- `order`: 排序方式 (asc, desc)

---

# 接口说明

1. 所有需要认证的接口都需要在请求头中添加 `Authorization: Bearer {token}`
2. 日期格式统一为 `yyyy-MM-dd HH:mm:ss`
3. 所有金额单位为人民币元，保留两位小数
4. 文件上传支持jpg、png、gif等格式，单文件大小不超过5MB
5. 接口返回结果中，`code` 为200表示成功，其他表示失败
6. 管理员接口只有admin角色可以访问，普通用户访问会返回403错误
